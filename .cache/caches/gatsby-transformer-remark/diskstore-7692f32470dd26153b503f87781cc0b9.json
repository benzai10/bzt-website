{"expireTime":9007200848104073000,"key":"transformer-remark-markdown-html-1b6f352b724ebdb58f6f13f5e8b9846d-gatsby-remark-imagesgatsby-remark-responsive-iframegatsby-remark-prismjsgatsby-remark-copy-linked-filesgatsby-remark-smartypants-","val":"<h2>mu4e and offlineimap or mbsync?</h2>\n<p>A few days ago on the subreddit\nr/emacs, I read that the new version 1.4 of mu/mu4e has been released.\nThe release notes contained enough improvements to get me try it once\nagain.</p>\n<p>I skimmed the update manual on the <a href=\"https://www.djcbsoftware.nl/code/mu/mu4e/\">mu/mu4e\nwebsite</a> and I got even\nmore excited that this time it might work when I saw a dedicated page\nfor <a href=\"https://www.djcbsoftware.nl/code/mu/mu4e/Gmail-configuration.html\">Gmail\nconfiguration</a>.</p>\n<p>This helped me to decide against using mbsync despite having read that\nmbsync is much faster than offlineimap.</p>\n<h2>Only Minor Problems with Standard Gmail</h2>\n<p>The installation via <code class=\"language-text\">yay -S mu</code> and <code class=\"language-text\">yay -S offlineimap</code> went without\nany hiccup on my system.</p>\n<h4>Configure offlineimap</h4>\n<p>One of my upcoming Kaizen tasks is to tidy up my home directory and\norganize it according to the <a href=\"https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html\">XDG Base Directory\nSpecification</a>.\nThat’s why it was really nice to read that the latest mu4e version\nsupports this specification.</p>\n<p>After getting an overview of the possible configuration settings in\nthe file <code class=\"language-text\">/usr/share/offlineimap/offlineimap.conf</code>, I copied the much\nsmaller <code class=\"language-text\">/usr/share/offlineimap/offline.conf.minimal</code> file to the\nnewly created <code class=\"language-text\">~/.config/offlineimap/</code> directory and renamed it to\njust <code class=\"language-text\">config</code>. </p>\n<p>I followed the Gmail settings instructions from the page mentioned\nabove and… yeah right, it didn’t work. But I was determined to not\ngive up too early. Since I tried to set up email on Emacs several\nyears ago, I’ve learned a lot about Emacs and I’ve gained much more\nconfidence that I would be able to handle the possible obstacles on\nthe way.</p>\n<p>Unless the Gmail account is not setup to allow ‘Less secure’ apps, the\nofflineimap configuration didn’t work. Furthermore, I had to add\n<code class=\"language-text\">sslcacertfile = /etc/ssl/certs/ca-certificates.crt</code> to the remote\nrepository section. But with this in place I successfully downloaded\nmy emails from some standard gmail accounts to my machine.</p>\n<h4>Getting mu4e Up and Running</h4>\n<p>This part worked pretty much according to the documentation:\n</p>\n<ul>\n<li>Initializing the message store with <code class=\"language-text\">mu init --maildir=~/Mails</code></li>\n<li>Check the settings with <code class=\"language-text\">mu info</code></li>\n<li>Indexing the messages with <code class=\"language-text\">mu index</code></li>\n<li>Adding additional mu4e settings to the Emacs configuration</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">(add-to-list &#39;load-path &quot;/usr/share/emacs/site-lisp/mu4e/mu4e&quot;)\n(require &#39;mu4e)\n\n;; save attachment to my desktop (this can also be a function)\n(setq mu4e-attachment-dir &quot;~/Desktop&quot;)\n\n;; attempt to show images when viewing messages\n(setq mu4e-view-show-images t)\n\n;; I have my &quot;default&quot; parameters from Gmail\n(setq mu4e-sent-folder &quot;/[Gmail].Sent Mail&quot;\n\t;; mu4e-sent-messages-behavior &#39;delete ;; Unsure how this should be configured\n\tmu4e-drafts-folder &quot;/[Gmail].Drafts&quot;\n\tmu4e-trash-folder &quot;/[Gmail].Trash&quot;\n\tuser-mail-address &quot;&lt;user&gt;@gmail.com&quot;\n\tsmtpmail-default-smtp-server &quot;smtp.gmail.com&quot;\n\tsmtpmail-smtp-server &quot;smtp.gmail.com&quot;\n\tsmtpmail-smtp-service 587)\n\n;; Now I set a list of \n(defvar my-mu4e-account-alist\n  &#39;((&quot;&lt;user&gt;@gmail.com&quot;\n     (mu4e-sent-folder &quot;/&lt;user&gt;@gmail.com/[Gmail].Sent Mail&quot;)\n     (user-mail-address &quot;&lt;user&gt;@gmail.com&quot;)\n     (smtpmail-smtp-user &quot;&lt;user&gt;&quot;)\n     (smtpmail-local-domain &quot;gmail.com&quot;)\n     (smtpmail-default-smtp-server &quot;smtp.gmail.com&quot;)\n     (smtpmail-smtp-server &quot;smtp.gmail.com&quot;)\n     (smtpmail-smtp-service 587)\n     )\n    ;; Include any other accounts here ...\n    ))\n\n(defun my-mu4e-set-account ()\n  &quot;Set the account for composing a message.\n   This function is taken from: \n     https://www.djcbsoftware.nl/code/mu/mu4e/Multiple-accounts.html&quot;\n  (let* ((account\n    (if mu4e-compose-parent-message\n\t  (let ((maildir (mu4e-message-field mu4e-compose-parent-message :maildir)))\n    (string-match &quot;/\\\\(.*?\\\\)/&quot; maildir)\n    (match-string 1 maildir))\n\t(completing-read (format &quot;Compose with account: (%s) &quot;\n\t       (mapconcat #&#39;(lambda (var) (car var))\n\t      my-mu4e-account-alist &quot;/&quot;))\n\t     (mapcar #&#39;(lambda (var) (car var)) my-mu4e-account-alist)\n\t     nil t nil nil (caar my-mu4e-account-alist))))\n   (account-vars (cdr (assoc account my-mu4e-account-alist))))\n    (if account-vars\n  (mapc #&#39;(lambda (var)\n\t(set (car var) (cadr var)))\n\t  account-vars)\n\t(error &quot;No email account found&quot;))))\n(add-hook &#39;mu4e-compose-pre-hook &#39;my-mu4e-set-account)</code></pre></div>\n<h2>No Luck with Custom Domain Gmail Accounts</h2>\n<p>For some email addresses I use for professional purposes, I have\ncustom domain Gmail accounts that don’t have end with @gmail.com. I\ntried several things in different settings combinations… Conclusion:\nIt doesn’t work.</p>\n<h4>Finding a Workaround to Make it Work</h4>\n<p>While trying to get it work with an <a href=\"https://support.google.com/accounts/answer/185833?hl=en\">app\npassword</a>\n(which I eventually used for the standard Gmail accounts), I lost the\npatience to find a possible solution and I started to check for a\nworkaround that’s good enough.</p>\n<h4>Objectives</h4>\n<p>The minimum functionality I wanted was</p>\n<ul>\n<li>All the emails from both, standard and custom domain email accounts\nin mu4e</li>\n<li>Being able to send and reply emails from mu4e</li>\n</ul>\n<h2>My Current Working Configuration</h2>\n<p>In my offlineimap config file, I have my standard Gmail accounts\nconfigured using the app passwords. Using GPG passwords is a task for\nlater. </p>\n<h4>Forwarding Emails from Custom Domain Accounts</h4>\n<p>In the Gmail settings for a custom domain account in the tab\n‘Forwarding and POP/IMAP’, add ‘Forwarding a copy…’ to one of the\nstandard Gmail accounts.</p>\n<h4>Configure ‘Send Email As’</h4>\n<p>In order to be able to send and reply as a sender of a custom domain\nemail address go to the standard Gmail account settings and add the\ncustom domain emails in the tab ‘Accounts and Import’.</p>\n<p>During the configuration process, uncheck the “Treat it as an alias”\ncheckbox and for the account credentials, use the app password for the\nstandard Gmail account.</p>\n<p>Don’t forget to add the custom domain email addresses to your mu\ninitialization (<code class=\"language-text\">mu init --my-address=&lt;address1&gt;\n--my-address=&lt;address2&gt;</code> etc.)</p>\n<h4>Automated Recurring Email Sync</h4>\n<p>I installed <code class=\"language-text\">cronie</code> from the Arch repository and started the service\nwith <code class=\"language-text\">systemctl enable cronie</code> and <code class=\"language-text\">systemctl start cronie</code>.</p>\n<p>The crontab (edit with <code class=\"language-text\">crontab -e</code>, display it with <code class=\"language-text\">crontab -l</code>) for\na sync every 5 minutes looks like this: <code class=\"language-text\">*/5 * * * * offlineimap -u\nquiet</code>.</p>\n<h2>Conclusion</h2>\n<p>I’m really happy that I finally made it! Using email in Emacs! And\nit’s already such a better experience than Thunderbird which I used\nuntil now.</p>\n<p>I guess it’s possible to create contexts to separate the standard and\ncustom domain emails but that’s something for later.</p>\n<p>One thing that I have to manually change when I reply to an email\nreceived with a custom domain account: The ‘From’ and ‘To’ addresses\nneed to be swapped. Also something to fix later. I can live with it at\nthe moment and just enjoy the new email experience.</p>\n<h2>Updates</h2>\n<h4>May 2020</h4>\n<p>There’s a problem when an email subject line in the inbox contains (certain)\nemojis. So far, I can say it’s reproducable with the checkmark emoji. The\nproblem is quite severe because when trying to access such an email, Emacs just\ncrashes and has to be restarted.</p>\n<p>In order to use mu4e again, the email culprit has to be removed first. I\ncurrently do that by launching Emacs in terminal mode with <code class=\"language-text\">emacs -nw</code> but this\ncan’t be a sustainable solution. Luckily, so far it happens only very\noccasionally but it needs to be rectified sooner or later.</p>"}